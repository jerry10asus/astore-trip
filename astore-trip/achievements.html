<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="AStore Trip" />
  <title>AStore Trip - 成就</title>
  <link rel="icon" type="image/png" href="./assets/app_icon.png" />
  <link rel="apple-touch-icon" href="./assets/app_icon.png" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./css/base.css" />
  <link rel="stylesheet" href="./css/glass.css" />
  <link rel="stylesheet" href="./css/layout.css" />
  <link rel="stylesheet" href="./css/pwa-update.css" />
  <link rel="stylesheet" href="./css/pwa-install.css" />
</head>
<body>
  <!-- Sheet 背景遮罩 -->
  <div class="sheet-backdrop" id="sheetBackdrop"></div>

  <!-- Sheet 容器 -->
  <div class="achievement-sheet" id="achievementSheet">
    <!-- Sheet Header -->
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <h1 class="sheet-title">成就</h1>
      <button class="sheet-close-btn" id="sheetCloseBtn" aria-label="關閉">
        <span class="close-icon">✕</span>
      </button>
    </div>

    <main class="achievements-main">
      <!-- 成就統計卡片 -->
      <section class="achievement-summary">
        <div class="summary-cards">
          <div class="summary-card">
            <div class="summary-icon">
              <img src="./assets/icon/Checkin.svg" alt="已造訪門市" />
            </div>
            <div class="summary-number-row">
              <div class="summary-card__number highlight-blue" id="achVisitedCount">3</div>
              <div class="summary-card__divider">/</div>
              <div class="summary-card__total">500</div>
            </div>
            <div class="summary-card__label">已造訪門市</div>
          </div>
          <div class="summary-card">
            <div class="summary-icon">
              <img src="./assets/icon/Achievement.svg" alt="獲得勳章" />
            </div>
            <div class="summary-card__number highlight-orange" id="achBadgeCount">2</div>
            <div class="summary-card__label">獲得勳章</div>
          </div>
        </div>
      </section>

      <!-- 歷史成就 -->
      <section class="historical-achievements">
        <h2 class="section-title">歷史成就</h2>
        <div class="country-flags-grid" id="countryFlagsGrid">
          <!-- Loading 狀態 -->
          <div class="medals-loading" id="medalsLoading">
            <div class="loading-spinner"></div>
            <div class="loading-text">載入中...</div>
          </div>
          <!-- 勳章將由 JavaScript 動態生成 -->
        </div>
      </section>
    </main>
  </div>

  <script src="./js/data.js"></script>
  <script src="./js/achievements.js"></script>
  <script src="./js/pwa-update.js"></script>
  <script src="./js/pwa-install.js"></script>
  <script>
    // Sheet 動畫和關閉功能
    document.addEventListener('DOMContentLoaded', () => {
      const sheet = document.getElementById('achievementSheet');
      const backdrop = document.getElementById('sheetBackdrop');
      const closeBtn = document.getElementById('sheetCloseBtn');

      // 顯示 sheet（從下往上動畫）
      setTimeout(() => {
        sheet.classList.add('show');
        backdrop.classList.add('show');
      }, 10);

      // 關閉 sheet
      function closeSheet() {
        sheet.classList.remove('show');
        backdrop.classList.remove('show');
        setTimeout(() => {
          window.history.back();
        }, 300);
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', closeSheet);
      }

      if (backdrop) {
        backdrop.addEventListener('click', closeSheet);
      }

      // 初始化頁面
      if (window.AchievementsPage) {
        window.AchievementsPage.init();
      }

      // Register Service Worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('Service Worker registered:', reg))
          .catch(err => console.error('Service Worker registration failed:', err));
      }
    });
  </script>
</body>
</html>
